<style>
	.table {
		border-collapse: collapse;
		width: 100%;
		text-align: center;
	}
	.table td {
		border: 1px solid #ccc;
		line-height: 2em;
	}
	.table tr.current {
		background-color: #ededed;
	}
	.none {
		display: none;
	}
	.btn {
		padding: .5em 1em;
		border-radius: 3px;
		color: #333;
		border:1px solid #ccc;
		cursor: pointer;
		display: inline-block;
	}
	.btns {
		margin-bottom: .5em;
	}
</style>
<!-- 测试插件 -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script>
	var baseURL = "http://134.175.154.93:6677";
//给添加操作绑定事件
	var btn_add=document.getElementById('btn_add');
	var tbody = document.getElementsByTagName("tbody")[0];
	//表单清空
	btn_add.onclick=function(){
		document.querySelector("input[name=realname]").value = "";
		document.querySelector("input[name=telephone]").value = "";
		document.querySelector("input[name=id]").value = "";
	}
//给提交按钮添加事件
	document.getElementById("submit").onclick=function(event){
			//选中提交按钮
			console.log(event.target);
			//要提交的数据
			var id = document.querySelector("input[name=id]").value;
		 	var realname = document.querySelector("input[name=realname]").value;
		 	var telephone = document.querySelector("input[name=telephone]").value;
			//异步提交
			//实例化
			var xhr=new XMLHttpRequest();
			//请求行
			xhr.open("POST",baseURL+"/customer/saveCustomerOrUpdateCustomer");
			xhr.responseType="json";
			xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
			xhr.send("id="+id+"&realname="+realname+"&telephone="+telephone);
			xhr.onreadystatechange = function(){
		 		if(this.readyState === 4){
		 			if(this.status === 200){
		 				if(this.response.status === 200){
		 					alert(this.response.message);
	 					reloadData();
		 				} else {
		 					alert("接口异常");
		 				}
		 			}
		 		}
		 	}
		 	event.preventDefault();
		}

		//数据删除和更新
		tbody.onclick = function(event){
			if(event.target.nodeName === "A"){
				switch(event.target.className){
					case "btn_del":
						// 1. 先获取要删除的id
						var id = event.target.parentNode.parentNode.firstElementChild.firstElementChild.value;
						// 2. 编写ajax进行删除
						var xhr = new XMLHttpRequest();
						xhr.open("POST",baseURL+"/customer/deleteCustomerById");
						xhr.responseType ="json";
						xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
						// id=1&name=terry
						xhr.send("id="+id);
						xhr.onreadystatechange = function(){
							if(this.readyState === 4){
								if(this.status === 200){
									console.log(this.response);
									if(this.response.status === 200){
										// 3. 重新查询数据进行页面刷新（局部）
										reloadData();
									} else {
										alert(this.response.message);
									}
								}
							}
						}

						break;
					case "btn_upd":
						var id = event.target.parentNode.parentNode.children[0].firstElementChild.value;
						var realname = event.target.parentNode.parentNode.children[1].innerText;
						var telephone = event.target.parentNode.parentNode.children[3].innerText;
						document.querySelector("input[name=realname]").value = realname;
						document.querySelector("input[name=telephone]").value = telephone;
						document.querySelector("input[name=id]").value = id;
						break;
				}
			}
		}

// 加载数据
	function reloadData(){
		var url = baseURL+"/customer/findCustomerAll";
		$.get(url,function(response,status){
			//1. 将tbody清空
			$("#customer_tbl tbody").empty();
			//2. 追加新的值
			response.data.forEach(function(item){
				var newTr = $(`<tr>
					<td><input type="checkbox" value="`+item.id+`"></td>
					<td>`+item.realname+`</td>
					<td>`+item.status+`</td>
					<td>`+item.telephone+`</td>
					<td>
						<a class="btn_del" href="#">删除</a>
						<a class="btn_upd" href="#">修改</a>
					</td>
				</tr>`);
				$("#customer_tbl").append(newTr)
			});
		});
	}
	// 文档加载完毕之后执行
	$(function(){
		//调用重载数据
		reloadData();
	})

	</script>

<div class="customer">
	<div class="btns">
		<div id="btn_add" class="btn">添加</div>
		<div id="btn_import" class="btn">批量导入</div>
	</div>
	
	<div style="margin-bottom: .5em">
		<!-- 表单 -->
		<form action="javascript:void(0)">
			<input type="hidden" name="id" />
			姓名<input type="text" name="realname"/>
			手机号 <input type="text" name="telephone"/>
			<input type="submit" id="submit" value="提交">
		</form>
	</div>

	<table class="table" id="customer_tbl">
		<thead>
			<tr>
				<td width="80px">编号</td>
				<td>姓名</td>
				<td>状态</td>
				<td>手机号</td>
				<td width="100px">操作</td>
			</tr>
		</thead>
		<tbody>			
		</tbody>
	</table>
</div>